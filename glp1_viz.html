<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLP-1 Access & Obesity: State-Level Analysis</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #ffffff;
        }
        .container {
            width: 100%;
            margin: 0;
            background: #ffffff;
            padding: 15px;
            box-sizing: border-box;
        }
        h1 {
            margin-top: 0;
            margin-bottom: 8px;
            color: #2c5f8d;
            font-size: 20px;
        }
        .subtitle {
            color: #555555;
            font-size: 13px;
            margin-bottom: 12px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 15px;
            margin-bottom: 0;
            max-width: 100%;
            overflow: visible;
            align-items: start;
        }
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .chart-container {
            background: #fafafa;
            padding: 12px;
            border-radius: 6px;
        }
        .chart-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 8px;
            color: #34495e;
        }
        .controls {
            margin-bottom: 10px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }
        select {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
        input[type="range"] {
            width: 180px;
            padding: 0;
            margin: 0;
        }
        .state-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
        }
        .state-info h2 {
            margin: 0 0 8px 0;
            font-size: 18px;
        }
        .stat {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .stat:last-child {
            border-bottom: none;
        }
        .stat-label {
            font-weight: 500;
            opacity: 0.9;
            font-size: 14px;
        }
        .stat-value {
            font-weight: 700;
            font-size: 16px;
        }
        circle {
            stroke: #fff;
            stroke-width: 1.5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        circle:hover {
            stroke-width: 3px;
            opacity: 1;
        }
        circle.selected {
            stroke: #000;
            stroke-width: 3px;
        }
        .axis text {
            font-size: 12px;
        }
        .axis-label {
            font-size: 14px;
            font-weight: 500;
        }
        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 4px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 200px;
        }
        .legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GLP-1 Access vs. Obesity: State-Level Analysis</h1>
        <p class="subtitle">
            Interactive exploration of GLP-1 prescription patterns across all 50 U.S. states.
        </p>

        <div class="controls">
            <div class="control-group">
                <label for="regionFilter">Filter by Region:</label>
                <select id="regionFilter">
                    <option value="all">All Regions</option>
                    <option value="South">South</option>
                    <option value="Northeast">Northeast</option>
                    <option value="Midwest">Midwest</option>
                    <option value="West">West</option>
                </select>
            </div>
            <div class="control-group">
                <label for="obesityFilter">Min Obesity Rate: <span id="obesityValue">0%</span></label>
                <input type="range" id="obesityFilter" min="0" max="45" value="0" step="1">
            </div>
            <div class="control-group">
                <label for="sizeByIncome">
                    <input type="checkbox" id="sizeByIncome" style="width: auto; margin-right: 5px;">
                    Size by Income
                </label>
            </div>
        </div>

        <div class="dashboard">
            <div class="chart-container">
                <div class="chart-title">GLP-1 Prescriptions vs. Obesity Rate by State <span id="sizeNote" style="font-size: 12px; font-weight: normal; color: #666;"></span></div>
                <svg id="scatterplot"></svg>
                <div class="legend" id="legend"></div>
            </div>
            <div class="right-panel">
                <div class="state-info" id="stateInfo">
                    <h2>Select a state</h2>
                    <p>Click on any state dot in the chart to view detailed information</p>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Top 10 States by GLP-1 Usage</div>
                    <svg id="barChart"></svg>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // VERIFIED DATA - All 50 states (2023 ACS median household income from U.S. Census Bureau)
        const rawData = [
  {"State": "Kentucky", "GLP1_Per_1000": 20.7, "Obesity_Rate": 40.0, "Region": "South", "Income": 61118},
  {"State": "West Virginia", "GLP1_Per_1000": 18.9, "Obesity_Rate": 41.2, "Region": "South", "Income": 55948},
  {"State": "Alaska", "GLP1_Per_1000": 17.5, "Obesity_Rate": 33.6, "Region": "West", "Income": 86631},
  {"State": "Mississippi", "GLP1_Per_1000": 16.1, "Obesity_Rate": 40.1, "Region": "South", "Income": 54203},
  {"State": "Louisiana", "GLP1_Per_1000": 15.4, "Obesity_Rate": 38.1, "Region": "South", "Income": 58229},
  {"State": "Tennessee", "GLP1_Per_1000": 13.8, "Obesity_Rate": 37.6, "Region": "South", "Income": 67631},
  {"State": "Alabama", "GLP1_Per_1000": 13.4, "Obesity_Rate": 39.9, "Region": "South", "Income": 62212},
  {"State": "Idaho", "GLP1_Per_1000": 13.3, "Obesity_Rate": 32.8, "Region": "West", "Income": 74942},
  {"State": "Arkansas", "GLP1_Per_1000": 13.3, "Obesity_Rate": 38.2, "Region": "South", "Income": 58700},
  {"State": "North Dakota", "GLP1_Per_1000": 13.2, "Obesity_Rate": 34.7, "Region": "Midwest", "Income": 76525},
  {"State": "Georgia", "GLP1_Per_1000": 12.5, "Obesity_Rate": 35.5, "Region": "South", "Income": 74632},
  {"State": "Iowa", "GLP1_Per_1000": 12.0, "Obesity_Rate": 36.5, "Region": "Midwest", "Income": 71433},
  {"State": "South Dakota", "GLP1_Per_1000": 11.9, "Obesity_Rate": 34.1, "Region": "Midwest", "Income": 71810},
  {"State": "Texas", "GLP1_Per_1000": 11.6, "Obesity_Rate": 35.8, "Region": "South", "Income": 75780},
  {"State": "Kansas", "GLP1_Per_1000": 11.4, "Obesity_Rate": 35.6, "Region": "Midwest", "Income": 70333},
  {"State": "North Carolina", "GLP1_Per_1000": 11.0, "Obesity_Rate": 34.1, "Region": "South", "Income": 70804},
  {"State": "Vermont", "GLP1_Per_1000": 10.4, "Obesity_Rate": 28.4, "Region": "Northeast", "Income": 81211},
  {"State": "Michigan", "GLP1_Per_1000": 10.0, "Obesity_Rate": 36.0, "Region": "Midwest", "Income": 69183},
  {"State": "Pennsylvania", "GLP1_Per_1000": 9.7, "Obesity_Rate": 33.0, "Region": "Northeast", "Income": 73824},
  {"State": "Wyoming", "GLP1_Per_1000": 9.5, "Obesity_Rate": 29.5, "Region": "West", "Income": 72415},
  {"State": "Oklahoma", "GLP1_Per_1000": 9.1, "Obesity_Rate": 37.1, "Region": "South", "Income": 62138},
  {"State": "South Carolina", "GLP1_Per_1000": 9.1, "Obesity_Rate": 35.4, "Region": "South", "Income": 67804},
  {"State": "Delaware", "GLP1_Per_1000": 8.9, "Obesity_Rate": 37.8, "Region": "South", "Income": 81361},
  {"State": "Indiana", "GLP1_Per_1000": 8.8, "Obesity_Rate": 36.6, "Region": "Midwest", "Income": 69477},
  {"State": "Ohio", "GLP1_Per_1000": 8.5, "Obesity_Rate": 35.5, "Region": "Midwest", "Income": 67769},
  {"State": "New York", "GLP1_Per_1000": 8.4, "Obesity_Rate": 28.0, "Region": "Northeast", "Income": 82095},
  {"State": "Montana", "GLP1_Per_1000": 8.2, "Obesity_Rate": 27.8, "Region": "West", "Income": 70804},
  {"State": "Nebraska", "GLP1_Per_1000": 8.1, "Obesity_Rate": 35.2, "Region": "Midwest", "Income": 74590},
  {"State": "Maine", "GLP1_Per_1000": 8.1, "Obesity_Rate": 31.3, "Region": "Northeast", "Income": 73733},
  {"State": "Missouri", "GLP1_Per_1000": 8.0, "Obesity_Rate": 35.3, "Region": "Midwest", "Income": 68545},
  {"State": "Virginia", "GLP1_Per_1000": 7.6, "Obesity_Rate": 32.2, "Region": "South", "Income": 89931},
  {"State": "Washington", "GLP1_Per_1000": 7.3, "Obesity_Rate": 29.5, "Region": "West", "Income": 94605},
  {"State": "Maryland", "GLP1_Per_1000": 7.2, "Obesity_Rate": 33.4, "Region": "South", "Income": 98678},
  {"State": "New Hampshire", "GLP1_Per_1000": 7.2, "Obesity_Rate": 29.3, "Region": "Northeast", "Income": 96838},
  {"State": "Florida", "GLP1_Per_1000": 7.1, "Obesity_Rate": 29.7, "Region": "South", "Income": 73311},
  {"State": "Oregon", "GLP1_Per_1000": 6.7, "Obesity_Rate": 31.4, "Region": "West", "Income": 80160},
  {"State": "New Jersey", "GLP1_Per_1000": 6.6, "Obesity_Rate": 28.2, "Region": "Northeast", "Income": 99781},
  {"State": "Connecticut", "GLP1_Per_1000": 5.8, "Obesity_Rate": 28.6, "Region": "Northeast", "Income": 91665},
  {"State": "Illinois", "GLP1_Per_1000": 5.8, "Obesity_Rate": 33.5, "Region": "Midwest", "Income": 80306},
  {"State": "Minnesota", "GLP1_Per_1000": 5.8, "Obesity_Rate": 29.8, "Region": "Midwest", "Income": 85086},
  {"State": "Utah", "GLP1_Per_1000": 5.7, "Obesity_Rate": 26.0, "Region": "West", "Income": 93421},
  {"State": "Nevada", "GLP1_Per_1000": 5.7, "Obesity_Rate": 29.1, "Region": "West", "Income": 76364},
  {"State": "California", "GLP1_Per_1000": 5.5, "Obesity_Rate": 28.0, "Region": "West", "Income": 95521},
  {"State": "New Mexico", "GLP1_Per_1000": 5.3, "Obesity_Rate": 32.9, "Region": "West", "Income": 62268},
  {"State": "Colorado", "GLP1_Per_1000": 5.1, "Obesity_Rate": 24.9, "Region": "West", "Income": 92911},
  {"State": "Arizona", "GLP1_Per_1000": 5.1, "Obesity_Rate": 31.4, "Region": "West", "Income": 77315},
  {"State": "Wisconsin", "GLP1_Per_1000": 4.3, "Obesity_Rate": 33.9, "Region": "Midwest", "Income": 74631},
  {"State": "Hawaii", "GLP1_Per_1000": 4.3, "Obesity_Rate": 24.5, "Region": "West", "Income": 95322},
  {"State": "Massachusetts", "GLP1_Per_1000": 4.0, "Obesity_Rate": 26.8, "Region": "Northeast", "Income": 99858},
  {"State": "Rhode Island", "GLP1_Per_1000": 3.7, "Obesity_Rate": 30.1, "Region": "Northeast", "Income": 84972}
];

        // Set up dimensions - responsive
        const margin = {top: 15, right: 15, bottom: 50, left: 55};
        const dashboardElement = document.querySelector('.dashboard');
        const containerWidth = dashboardElement.offsetWidth;
        const scatterContainer = dashboardElement.querySelector('.chart-container');
        const width = scatterContainer.offsetWidth - margin.left - margin.right - 24;
        const height = 380 - margin.top - margin.bottom;

        // Color scale for regions
        const regionColors = {
            'South': '#e74c3c',
            'Northeast': '#3498db',
            'Midwest': '#f39c12',
            'West': '#27ae60'
        };

        // Create legend
        const legend = d3.select('#legend');
        Object.entries(regionColors).forEach(([region, color]) => {
            const item = legend.append('div').attr('class', 'legend-item');
            item.append('div')
                .attr('class', 'legend-color')
                .style('background-color', color);
            item.append('span').text(region);
        });

        let selectedState = null;
        let filteredData = rawData;
        let sizeByIncome = false;

        // Scatterplot
        function createScatterplot() {
            d3.select('#scatterplot').selectAll('*').remove();

            const svg = d3.select('#scatterplot')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLinear()
                .domain([20, d3.max(filteredData, d => d.Obesity_Rate) + 2])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(filteredData, d => d.GLP1_Per_1000) + 2])
                .range([height, 0]);

            // Axes
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .append('text')
                .attr('class', 'axis-label')
                .attr('x', width / 2)
                .attr('y', 40)
                .attr('fill', '#000')
                .text('Obesity Rate (%)');

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y))
                .append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', -45)
                .attr('fill', '#000')
                .text('GLP-1 Prescriptions per 1,000');

            // Data points
            const tooltip = d3.select('#tooltip');

            // Income scale for bubble size
            const incomeScale = d3.scaleSqrt()
                .domain([d3.min(filteredData, d => d.Income), d3.max(filteredData, d => d.Income)])
                .range([5, 15]);

            svg.selectAll('circle')
                .data(filteredData)
                .enter()
                .append('circle')
                .attr('cx', d => x(d.Obesity_Rate))
                .attr('cy', d => y(d.GLP1_Per_1000))
                .attr('r', d => sizeByIncome ? incomeScale(d.Income) : 8)
                .attr('fill', d => regionColors[d.Region])
                .attr('opacity', 0.7)
                .classed('selected', d => d === selectedState)
                .on('mouseover', function(event, d) {
                    tooltip
                        .style('opacity', 1)
                        .html(`<strong>${d.State}</strong><br/>
                               Obesity: ${d.Obesity_Rate}%<br/>
                               GLP-1: ${d.GLP1_Per_1000} per 1,000<br/>
                               Median Income: $${d.Income.toLocaleString()}<br/>
                               Region: ${d.Region}`)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 10) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.style('opacity', 0);
                })
                .on('click', function(event, d) {
                    selectedState = d;
                    updateStateInfo(d);
                    createScatterplot();
                });
        }

        // Bar chart for top states
        function createBarChart() {
            d3.select('#barChart').selectAll('*').remove();

            const barContainer = document.querySelector('#barChart').parentElement;
            const barWidth = barContainer.offsetWidth - 24 - 85;
            const barHeight = 200;
            const barMargin = {top: 10, right: 10, bottom: 25, left: 75};

            const svg = d3.select('#barChart')
                .attr('width', barWidth + barMargin.left + barMargin.right)
                .attr('height', barHeight + barMargin.top + barMargin.bottom)
                .append('g')
                .attr('transform', `translate(${barMargin.left},${barMargin.top})`);

            const topStates = filteredData
                .sort((a, b) => b.GLP1_Per_1000 - a.GLP1_Per_1000)
                .slice(0, 10);

            const y = d3.scaleBand()
                .domain(topStates.map(d => d.State))
                .range([0, barHeight])
                .padding(0.1);

            const x = d3.scaleLinear()
                .domain([0, d3.max(topStates, d => d.GLP1_Per_1000)])
                .range([0, barWidth]);

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y))
                .selectAll('text')
                .style('font-size', '11px');

            svg.selectAll('rect')
                .data(topStates)
                .enter()
                .append('rect')
                .attr('x', 0)
                .attr('y', d => y(d.State))
                .attr('width', d => x(d.GLP1_Per_1000))
                .attr('height', y.bandwidth())
                .attr('fill', d => regionColors[d.Region])
                .attr('opacity', 0.8);
        }

        // Update state info panel
        function updateStateInfo(state) {
            const info = d3.select('#stateInfo');
            info.html(`
                <h2>${state.State}</h2>
                <div class="stat">
                    <span class="stat-label">Obesity Rate</span>
                    <span class="stat-value">${state.Obesity_Rate}%</span>
                </div>
                <div class="stat">
                    <span class="stat-label">GLP-1 Prescriptions</span>
                    <span class="stat-value">${state.GLP1_Per_1000} per 1,000</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Median Household Income</span>
                    <span class="stat-value">$${state.Income.toLocaleString()}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Region</span>
                    <span class="stat-value">${state.Region}</span>
                </div>
            `);
        }

        // Filters
        d3.select('#regionFilter').on('change', function() {
            const region = this.value;
            filteredData = region === 'all' ? rawData : rawData.filter(d => d.Region === region);
            updateCharts();
        });

        d3.select('#obesityFilter').on('input', function() {
            const threshold = +this.value;
            d3.select('#obesityValue').text(threshold + '%');
            filteredData = rawData.filter(d => d.Obesity_Rate >= threshold);
            const region = d3.select('#regionFilter').node().value;
            if (region !== 'all') {
                filteredData = filteredData.filter(d => d.Region === region);
            }
            updateCharts();
        });

        d3.select('#sizeByIncome').on('change', function() {
            sizeByIncome = this.checked;
            d3.select('#sizeNote').text(sizeByIncome ? '(circle size = median income)' : '');
            updateCharts();
        });

        function updateCharts() {
            createScatterplot();
            createBarChart();
        }

        // Initial render
        updateCharts();
    </script>
</body>
</html>
